# SAUWA - Apache Configuration
# Generated by Astro build process

<IfModule mod_rewrite.c>
    RewriteEngine On

    # ============================================
    # LANGUAGE DETECTION & REDIRECT (Fix: No more "Redirecting..." text)
    # ============================================

    # Redirect root (/) to language-specific homepage
    # Priority order: Accept-Language header â†’ Default (ES)

    RewriteCond %{REQUEST_URI} ^/$
    RewriteCond %{HTTP:Accept-Language} ^ca [NC]
    RewriteRule ^$ /ca/ [R=302,L]

    RewriteCond %{REQUEST_URI} ^/$
    RewriteCond %{HTTP:Accept-Language} ^en [NC]
    RewriteRule ^$ /en/ [R=302,L]

    RewriteCond %{REQUEST_URI} ^/$
    RewriteCond %{HTTP:Accept-Language} ^fr [NC]
    RewriteRule ^$ /fr/ [R=302,L]

    # Default: Redirect to Spanish (if no match or ES browser)
    RewriteCond %{REQUEST_URI} ^/$
    RewriteRule ^$ /es/ [R=302,L]

    # ============================================
    # SITEMAP PROXY TO WORDPRESS BACKEND (WDA-555)
    # ============================================

    # Proxy sitemap.xml to WordPress backend
    # Option 1: Direct proxy (requires mod_proxy)
    # RewriteRule ^sitemap\.xml$ https://backend.sauwasauna.com/sitemap.xml [P,L]

    # Option 2: PHP proxy (more compatible with shared hosting)
    RewriteRule ^sitemap\.xml$ sitemap-proxy.php [L]
</IfModule>

# ============================================
# SECURITY HEADERS
# ============================================

<IfModule mod_headers.c>
    # X-Content-Type-Options
    Header set X-Content-Type-Options "nosniff"

    # X-Frame-Options
    Header set X-Frame-Options "SAMEORIGIN"

    # Referrer-Policy
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# ============================================
# CACHE CONTROL
# ============================================

<IfModule mod_expires.c>
    ExpiresActive On

    # HTML (no cache for dynamic content)
    ExpiresByType text/html "access plus 0 seconds"

    # CSS and JavaScript
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"

    # Images
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"

    # Fonts
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
</IfModule>

# ============================================
# COMPRESSION
# ============================================

<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE text/xml
</IfModule>
