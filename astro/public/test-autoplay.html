<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Safari 18.1 Autoplay Diagnostic Tool - SAUWA</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      padding: 2rem;
      min-height: 100vh;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      opacity: 0.8;
      margin-bottom: 2rem;
    }

    .info-box {
      background: rgba(255, 255, 255, 0.1);
      border-left: 4px solid #4ade80;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 2rem;
    }

    .info-box.warning {
      border-left-color: #fbbf24;
    }

    .info-box.error {
      border-left-color: #ef4444;
    }

    .status {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin: 1rem 0;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
    }

    .status-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .status-icon.success {
      background: #4ade80;
    }

    .status-icon.error {
      background: #ef4444;
    }

    .status-icon.pending {
      background: #fbbf24;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    video {
      width: 100%;
      height: 300px;
      object-fit: cover;
      border-radius: 12px;
      margin: 1rem 0;
    }

    .button {
      background: #4ade80;
      color: #000;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .button:hover {
      transform: scale(1.05);
    }

    .button:active {
      transform: scale(0.95);
    }

    code {
      background: rgba(0, 0, 0, 0.5);
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
    }

    .log {
      background: #000;
      color: #0f0;
      padding: 1rem;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 1rem;
    }

    .log-entry {
      margin: 0.25rem 0;
    }

    .log-entry.success {
      color: #4ade80;
    }

    .log-entry.error {
      color: #ef4444;
    }

    .log-entry.warning {
      color: #fbbf24;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Safari 18.1 Autoplay Diagnostic</h1>
    <p class="subtitle">SAUWA - Video Autoplay Test Tool</p>

    <div class="info-box">
      <strong>Browser Detected:</strong> <span id="browser-info">Detecting...</span>
    </div>

    <div class="status">
      <div class="status-icon pending" id="autoplay-icon">?</div>
      <div>
        <strong id="autoplay-status">Testing autoplay capability...</strong>
        <p id="autoplay-detail" style="opacity: 0.8; font-size: 0.9rem;"></p>
      </div>
    </div>

    <video
      id="test-video"
      autoplay
      loop
      muted
      playsinline
      preload="auto"
      style="display: none;"
    >
      <source src="/images/hero/desktop/sauwa-hero-desktop.mp4" type="video/mp4" />
    </video>

    <div class="info-box warning" id="solution-box" style="display: none;">
      <strong>Solution for Safari 18.1:</strong>
      <ol style="margin: 1rem 0 0 1.5rem;">
        <li>Click <strong>Safari menu</strong> in menu bar</li>
        <li>Select <strong>Settings for demo2.sauwasauna.com</strong></li>
        <li>Under <strong>Auto-Play</strong>, choose <strong>"Allow All Auto-Play"</strong></li>
        <li>Reload this page</li>
      </ol>
    </div>

    <button class="button" onclick="testAutoplayManually()" style="margin-top: 1rem;">
      Test Autoplay Again
    </button>

    <div class="log" id="log">
      <div class="log-entry">Initializing diagnostic tool...</div>
    </div>

    <div class="info-box" style="margin-top: 2rem;">
      <strong>Technical Details:</strong>
      <ul style="margin: 0.5rem 0 0 1.5rem;">
        <li><code>autoplay</code> attribute: Present</li>
        <li><code>muted</code> attribute: Present</li>
        <li><code>playsinline</code> attribute: Present</li>
        <li><code>preload</code>: auto</li>
        <li>Video source: <code>/images/hero/desktop/sauwa-hero-desktop.mp4</code></li>
      </ul>
    </div>
  </div>

  <script>
    const log = document.getElementById('log');
    const autoplayIcon = document.getElementById('autoplay-icon');
    const autoplayStatus = document.getElementById('autoplay-status');
    const autoplayDetail = document.getElementById('autoplay-detail');
    const solutionBox = document.getElementById('solution-box');
    const testVideo = document.getElementById('test-video');

    function addLog(message, type = 'info') {
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;
    }

    function detectBrowser() {
      const ua = navigator.userAgent;
      const isSafari = /^((?!chrome|android).)*safari/i.test(ua);
      const isChrome = /chrome/i.test(ua);
      const isFirefox = /firefox/i.test(ua);

      let browserName = 'Unknown';
      let version = 'Unknown';

      if (isSafari) {
        browserName = 'Safari';
        const match = ua.match(/Version\/([\d.]+)/);
        if (match) version = match[1];
      } else if (isChrome) {
        browserName = 'Chrome';
        const match = ua.match(/Chrome\/([\d.]+)/);
        if (match) version = match[1];
      } else if (isFirefox) {
        browserName = 'Firefox';
        const match = ua.match(/Firefox\/([\d.]+)/);
        if (match) version = match[1];
      }

      const osMatch = ua.match(/Mac OS X ([\d_]+)/);
      const os = osMatch ? `macOS ${osMatch[1].replace(/_/g, '.')}` : 'Unknown OS';

      const info = `${browserName} ${version} on ${os}`;
      document.getElementById('browser-info').textContent = info;
      addLog(`Browser: ${info}`);

      return { browserName, version, os, isSafari };
    }

    function testAutoplay() {
      const video = testVideo;

      addLog('Attempting autoplay...', 'info');

      video.muted = true;
      video.playsInline = true;
      video.defaultMuted = true;
      video.load();

      const playPromise = video.play();

      if (playPromise !== undefined) {
        playPromise
          .then(() => {
            addLog('Autoplay SUCCESS!', 'success');
            autoplayIcon.className = 'status-icon success';
            autoplayIcon.textContent = '✓';
            autoplayStatus.textContent = 'Autoplay is WORKING';
            autoplayDetail.textContent = 'Your Safari settings allow video autoplay. The site will work correctly.';
            video.style.display = 'block';
          })
          .catch((error) => {
            addLog(`Autoplay BLOCKED: ${error.name}`, 'error');
            addLog(`Error message: ${error.message}`, 'error');

            autoplayIcon.className = 'status-icon error';
            autoplayIcon.textContent = '✗';
            autoplayStatus.textContent = 'Autoplay is BLOCKED';
            autoplayDetail.textContent = `Error: ${error.name} - Safari is preventing autoplay.`;
            solutionBox.style.display = 'block';

            // Test if interaction helps
            addLog('Testing interaction-based playback...', 'warning');
            const playOnClick = () => {
              video.play()
                .then(() => {
                  addLog('Video plays after user interaction', 'success');
                  video.style.display = 'block';
                })
                .catch(e => addLog(`Still blocked: ${e.message}`, 'error'));
              document.removeEventListener('click', playOnClick);
            };
            document.addEventListener('click', playOnClick, { once: true });
          });
      }
    }

    function testAutoplayManually() {
      addLog('Manual test initiated', 'info');
      testVideo.style.display = 'none';
      testAutoplay();
    }

    // Initialize
    const browserInfo = detectBrowser();

    if (!browserInfo.isSafari) {
      addLog('WARNING: Not Safari - test may not be accurate', 'warning');
    }

    // Start test after 1 second
    setTimeout(() => {
      testAutoplay();
    }, 1000);
  </script>
</body>
</html>
